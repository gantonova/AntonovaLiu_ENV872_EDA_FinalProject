---
title: "VUStats Data Exploration"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load the Data}

#Load the data

library(readr)
Visitation_by_Month <- read_csv("./Visitation_by_Month.csv")
getwd()
View(Visitation_by_Month)
```
```{r Wrangle the data}
#Pivot Longer to create a tidy dataset
library(tidyverse)

# Gather nutrient data into one column using pivot_longer
Visitation_by_month_gathered <- Visitation_by_Month %>%
  pivot_longer(JAN:DEC, names_to = "Month", values_to = "Recreational_Visits")

#Create a date column

library(lubridate)
paste(Visitation_by_month_gathered$Year,Visitation_by_month_gathered$Month, sep="-")
paste(Visitation_by_month_gathered$Year, Visitation_by_month_gathered$Month, "1", sep="-")

Visitation_by_month_gathered$Date <- ymd( paste(Visitation_by_month_gathered$Year, Visitation_by_month_gathered$Month, "1", sep="-") )
head(Visitation_by_month_gathered)

Visitation_by_month_gathered <- filter(Visitation_by_month_gathered, Year > 1998 & Year < 2020 )

```
```{r Data Exploration, echo=TRUE}

library(ggplot2)
head(Visitation_by_month_gathered)
summary(Visitation_by_month_gathered$Recreational_Visits)



Visitation_by_month_plot <- ggplot(Visitation_by_month_gathered, aes(x = Date, y = Recreational_Visits)) +
  geom_point()+
  geom_smooth()
print(Visitation_by_month_plot)

visitation_by_month_plot2 <- ggplot(Visitation_by_month_gathered, aes(x = Month, y = Recreational_Visits, label=TRUE, abbr=TRUE, group=factor(Year), color=factor(Year))) +
  geom_line() +
  geom_point() +
  labs(x="Month", colour="Year", y = "Recreational Visits")
print(visitation_by_month_plot2)



```

```{r Time Series Analysis of Visitation Data}

#Question: Has there been an increasing or decreasing visitation trend for Yosemite National Park between 1999 and 2019?

Visitation_by_month_gathered_ts <- ts(Visitation_by_month_gathered$Recreational_Visits, start = c(1999,1), frequency = 12)

# Generate the decomposition
Visitation_by_month_Decomposed <- stl(Visitation_by_month_gathered_ts, s.window = "periodic")

# Visualize the decomposed series. 
plot(Visitation_by_month_Decomposed)

#mostly monotonic trend - visitation appears to be decreasing overall

# Run SMK test
library(Kendall)
Visitation_by_month_trend1 <- Kendall::SeasonalMannKendall(Visitation_by_month_gathered_ts)

#Answer: The seasonal Mann-Kendall test is the most appropriate because this ozone data has seasonality as seen in the decomposed time series plot and is non-parametric.

# Inspect results
Visitation_by_month_trend1
summary(Visitation_by_month_trend1)

#The p-value us less than 0.05, so we reject the null hypothesis that the data is stationary, therefore we have a trend over time. Visitation appears to be decreasing over time in Yosemite National Park. 

Visitation_by_month_trend2 <- trend::smk.test(Visitation_by_month_gathered_ts)
# Inspect results
Visitation_by_month_trend2
summary(Visitation_by_month_trend2)


```

